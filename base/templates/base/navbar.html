{% load static %}

<style>
nav .dropdown-toggle::after {
    display: none !important;
}

nav .dropdown-menu {
    background: rgba(45, 45, 57, 0.9);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);

    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;

    box-shadow:
        0 8px 20px rgba(0, 0, 0, 0.35),
        0 2px 6px rgba(0, 0, 0, 0.25);

    min-width: 180px;
    padding: 6px;
    animation: dropdownFade 0.25s ease;
}

@keyframes dropdownFade {
    from {
        opacity: 0;
        transform: translateY(8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.dropdown-item {
    background: transparent;
    color: var(--color-text-secondary);
    border-radius: 8px;
    padding: 8px 12px;
    transition: all 0.25s ease;
}

.dropdown-item:hover {
    background: rgba(87, 187, 221, 0.15);
    color: var(--color-primary);
}

.dropdown-divider {
    border-top: 1px solid rgba(255, 255, 255, 0.08);
}

@media screen and (max-width:768px) {
    nav .dropdown-menu{
        min-width: 160px ;
    }
}

@media screen and (max-width:576px) {
    nav .dropdown-menu{
        min-width: 150px ;
    }
}

</style>


<nav class="navbar py-3">
    <div class="container">

        <div class="d-flex ">
            <!-- =============== navbar brand starts =============== -->
            <a href="{% url 'homepage' %}" class="navbar-brand d-flex justify-content-center align-items-center">
                <img src="{% static 'images/logo.svg' %}" alt="Studyhub logo">
                <h1 class="text-white fw-bold mb-0 ms-2">StudyHub</h1>
            </a>
            <!-- =============== navbar brand ends =============== -->

            <!-- =============== search starts =============== -->
            <form  method="GET" action="{% url 'homepage' %}" role="search" class="d-flex align-items-center search-bar">
                <div class="form-control form-control-sm d-flex align-items-center w-100">
                    <svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 640 640"
                        width="20"
                        height="20"
                        fill="currentColor"
                        class=" ms-2 me-1 ">
                        <title>Search</title>
                        <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/>
                        </svg>
                    <input type="search" name="q"  placeholder="Search for rooms" aria-label="search" class="search-input">
                </div>
            </form>
            <!-- =============== search ends =============== -->
        </div>


        <!-- =============== user section starts =============== -->
        {% if request.user.is_authenticated %}
        <div class="dropdown">
            <button class="d-flex align-items-center dropdown-toggle cursor-pointer border-0 bg-transparent" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" style="cursor:pointer;">

                <!-- Profile Image -->
                <div class="me-2">
                    {% if request.user.avatar and request.user.avatar.name != "profile.svg" %}
                        <div style="border: 2px solid var(--color-primary); border-radius: 50%;">
                            <img src="{{ request.user.avatar.url }}" class="rounded-circle" width="40" height="40" style="object-fit: cover;" alt="Profile Picture">
                        </div>
                    {% else %}
                        <img src="{% static 'images/profile.svg' %}" class="rounded-circle" width="40" height="40" alt="Default avatar">
                    {% endif %}
                </div>

                <!-- Name + Username -->
                <div class="me-2">
                    <div class="color-text-secondary text-start fw-semibold" style="font-size: 15px;">
                        {{ request.user.name|default:request.user.username|truncatechars:8 }}
                    </div>
                    <div class="color-primary text-start" style="font-size: 14px;">
                        @{{ request.user.username|truncatechars:9 }}
                    </div>
                </div>
       
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down color-text-secondary" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
                </svg>

            </button>

            <!-- Dropdown Menu -->
            <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">

                <li>
                    <a class="dropdown-item d-flex align-items-center " href="{% url 'user-profile' request.user.username %}" >
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill me-2" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                        </svg>
                        Profile
                    </a>
                </li>

                <li>
                    <a class="dropdown-item d-flex align-items-center" href="#" >
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear-fill me-2" viewBox="0 0 16 16">
                            <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                         </svg>
                        Settings
                    </a>
                </li>

                <li><hr class="dropdown-divider"></li>

                <li>
                    <a class="dropdown-item d-flex align-items-center" href="{% url 'logout' %}" >
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right me-2" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                            <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                        </svg>
                        Logout
                    </a>
                </li>

            </ul>
        </div>
        {% else %}
        <div style="height: 40px;" class="d-flex align-items-center">
            <div class="me-3 h-100 rounded-circle">
                <img src="{% static 'images/profile.svg' %}" alt="Profile picture" class="h-100 w-100 rounded-circle">
            </div>
            <a href="{% url 'login' %}" class="text-decoration-none login-btn">Login</a>
        </div>
        {% endif %}
        <!-- =============== user section ends =============== -->
         
    </div>
</nav>