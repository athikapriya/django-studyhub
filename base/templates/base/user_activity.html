{% extends 'base/main.html' %}
{% load static %}

{% block css %}
<style>
    .activity{
        border: 0.093rem solid var(--color-neutral);
        padding: 1.25rem;
        margin-bottom: 1rem;
    }

    .activity:last-child{
        margin-bottom: 0;
    }

    .activity-message{
        background-color: #2d2d39;
        padding: 0.30rem 0.75rem;
    }

    .message-user{
        font-size: 0.85rem;
    }

    .message-user__time{
        font-size: 0.8rem;
    }

    .dropdown-item.trash-msg:hover{
        background-color: transparent;
    }
</style>
{% endblock %}


{% block content %}
<!-- =============== activity section starts here =============== -->

<main id="activity-components">
    <div class="container">
        <div class="row my-5">
            <div class="col-10 col-sm-8 col-md-7 col-lg-6 col-xl-5 mx-auto">

                <div class="card text-bg-secondary" >
                    <div class="card-header d-flex align-items-center gap-2 text-uppercase color-text-primary color-bg-surface">
                        <a href="{% url 'homepage' %}" class="text-decoration-none d-flex align-items-center justify-content-center">
                            <svg xmlns="http://www.w3.org/2000/svg" 
                                viewBox="0 0 640 640"
                                width="18"
                                height="18"
                                fill="currentColor"
                                class="color-text-primary">
                                <title>Back</title>
                                <path d="M41.4 297.4C28.9 309.9 28.9 330.2 41.4 342.7L169.4 470.7C181.9 483.2 202.2 483.2 214.7 470.7C227.2 458.2 227.2 437.9 214.7 425.4L141.3 352L576 352C593.7 352 608 337.7 608 320C608 302.3 593.7 288 576 288L141.3 288L214.7 214.6C227.2 202.1 227.2 181.8 214.7 169.3C202.2 156.8 181.9 156.8 169.4 169.3L41.4 297.3z"/>
                            </svg>
                        </a>
                        <span>Recent Activity</span>
                    </div>
                    <div class="card-body color-bg-main">
                        {% for message in user_activity %}

                        <div class="activity rounded-2">
                            <!-- =============== message info starts with action =============== -->
                            <div class="d-flex">

                                <div class="col-11">
                                    <div class="d-flex gap-2">
                                        {% if message.user.avatar and message.user.avatar.name != "profile.svg" %}
                                            <div style="border: 2px solid var(--color-primary); border-radius: 50%; width: auto; height: 34px;">
                                                <img src="{{ message.user.avatar.url }}" class="rounded-circle" width="30" height="30" style="object-fit: cover;" alt="Profile Picture">
                                            </div>
                                        {% else %}
                                            <img src="{% static 'images/profile.svg' %}" class="rounded-circle" width="30" height="30" alt="Default avatar">
                                        {% endif %}

                                        <div class="message-user">
                                            <a href="{% url 'user-profile' message.user.username %}" class="text-decoration-none color-primary ">@{{message.user.username|truncatechars:10}}</a>
                                            <span class="d-block color-text-secondary message-user__time">{{message.created_at|timesince}} ago</span>
                                            <span class=" color-text-tertiary">replied to post</span>
                                            <span class="d-block color-primary mt-1">" {{message.room}} "</span>
                                        </div>
                                    </div>
                                    
                                </div>

                                <div class="col-1">
                                    {% if request.user == message.user or request.user == message.room.host %}
                                    <form method="POST" action="{% url 'delete-message' message.id %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="next" value="{{ request.path }}">
                                        <button type="submit" class="dropdown-item text-center p-0 trash-msg">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill color-text-secondary" viewBox="0 0 16 16">
                                                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/>
                                            </svg>
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- =============== message info ends with action =============== -->

                            <!-- =============== message starts =============== -->
                            <div class="activity-message rounded-1 mt-2 color-text-tertiary">
                                {{message}}
                            </div>
                            <!-- =============== message ends =============== -->
                        </div>

                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>
    </div>
</main>

<!-- =============== activity section ends here =============== -->
{% endblock %}